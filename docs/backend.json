{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Ephemeral Notes application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo, if available.",
          "format": "uri"
        },
        "creationTimestamp": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "creationTimestamp"
      ]
    },
    "Note": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Note",
      "type": "object",
      "description": "Represents a note created by a user in the Ephemeral Notes application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Note entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Note)"
        },
        "content": {
          "type": "string",
          "description": "Content of the note."
        },
        "customUrl": {
          "type": "string",
          "description": "The custom URL for accessing the note (e.g., 'XJUV')."
        },
        "creationTimestamp": {
          "type": "string",
          "description": "Timestamp when the note was created.",
          "format": "date-time"
        },
        "expirationTimestamp": {
          "type": "string",
          "description": "Timestamp when the note will expire and be deleted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "content",
        "customUrl",
        "creationTimestamp",
        "expirationTimestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Path-based ownership enforced.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, obtained from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/notes/{noteId}",
        "definition": {
          "entityName": "Note",
          "schema": {
            "$ref": "#/backend/entities/Note"
          },
          "description": "Stores notes created by each user. Includes `userId` (denormalized) for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user, obtained from Firebase Authentication.  Represents the owner of the note."
            },
            {
              "name": "noteId",
              "description": "The unique ID of the note."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "adminRole",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Tracks admin roles. Existence of a document indicates admin status.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure secure and scalable storage for Ephemeral Notes, focusing on user authentication and data isolation. It leverages path-based ownership for notes, placing them within user-specific collections, and denormalizes the user id to the Note for authorization independence. This structure facilitates straightforward security rules and efficient data retrieval. The design also supports the 'list' operation, which returns only the notes that are owned by the authenticated user.\n\nThe key collections are:\n\n*   `/users/{userId}`: Stores user profile data. Path-based ownership ensures only the authenticated user can access their own profile.\n*   `/users/{userId}/notes/{noteId}`: Stores notes created by each user. This hierarchical structure simplifies security rules, allowing notes to be easily associated with their respective users. The `note.userId` field allows rules to be written without need for parent document reads, facilitating authorization independence.\n*   `/roles_admin/{userId}`: Tracks admin roles, determined by document existence."
  }
}